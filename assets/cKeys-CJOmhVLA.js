import{u as M}from"./keys-B2Yzx80y.js";import{e as $,u as U,f as V,g as A,h as z,a as o,w as l,F,r as f,o as x,d as b,i as y,t as C,j as S,c as R,k as W,E as c,l as j}from"./index-C2e5BLRZ.js";import{f as v,t as D}from"./toBinary-Cl-Oq6Do.js";import{_ as G}from"./cTable-B2Y23O8K.js";const L=b("h2",null,"Copy and share public key",-1),q={class:"drawer-media-wrapper"},J={class:"drawer-media"},O={class:"drawer-media"},Q=b("h2",null,"Generate keypair",-1),oe={__name:"cKeys",setup(X){const g=$(window.outerWidth<900),k=U(),a=M(),s=V({name:"",passphrase:"",rpassphrase:""}),_=$(!1),i=V({isActive:!1,name:"",pub:"",priv:""});async function K(t){let e=!1;if(s.passphrase!=s.rpassphrase&&(c.error({title:"Invalid input",message:"Passphrases do not match"}),e=!0,await w(1)),a.pub.findIndex(B=>B.name==s.name)!=-1&&(c.error({title:"Invalid input",message:"Name already exists"}),e=!0,await w(1)),s.name==""&&(c.error({title:"Invalid input",message:"Name must not be empty"}),e=!0,await w(1)),e)return;_.value=!0;let r=v.pki.rsa.generateKeyPair({bits:1024}),p=v.pki.encryptRsaPrivateKey(r.privateKey,D(s.passphrase)),m=v.pki.publicKeyToPem(r.publicKey);console.log(p),_.value=!1;let n=new Date;const d=n.getUTCHours().toString().padStart(2,"0"),h=n.getUTCMinutes().toString().padStart(2,"0"),u=n.getMonth().toString().padStart(2,"0"),P=n.getDate().toString().padStart(2,"0");a.pub.push({date:`${d}:${h.toString().padStart(2)} - ${P}.${u}`,name:s.name,key:m,priv:p}),a.set(),console.log(m),console.log(`"${s.name}" public key was created`)}function w(t){return new Promise(e=>setTimeout(e,t))}function E(t){let e=a.pub.findIndex(r=>r.name==t);i.isActive=!0,i.pub=a.pub[e].key,i.priv=a.pub[e].priv,i.name=a.pub[e].name,console.log(`"${t}" public key was shown`)}function H(t){navigator.clipboard.writeText(i.pub).then(()=>{c.success("Copied to clipboard")}).catch(e=>{c.error("Error during copying")}),console.log(`"${i.name}" public key was copied`)}function T(t){navigator.clipboard.writeText(i.priv).then(()=>{c.success("Copied to clipboard")}).catch(e=>{c.error("Error during copying")}),console.log(`"${i.name}" public key was copied`)}function I(t,e){let r=a.pub.findIndex(p=>p.name==t);if(e=="click"){let p=window.location.protocol,m=window.location.hostname,n=window.location.port;n==""&&(n="443");let{href:d}=k.resolve({path:"encrypt",query:{publicKey:btoa(a.pub[r].key)}});navigator.clipboard.writeText(`${p}//${m}:${n}/Crypter/${d}`).then(()=>{c.success("Copied to clipboard")}).catch(h=>{c.error("Error during copying")}),console.log(`link to "${i.name}" public key was copied`)}else e=="cancel"?console.log(`redirect to "${t}" public key cancelled`):e=="confirm"&&(k.push({path:"encrypt",query:{publicKey:btoa(a.pub[r].key)}}),console.log(`redirect to "${t}" public key confirmed`))}function N(t){let e=a.pub.findIndex(r=>r.name==t);j.confirm(`Are you sure to delete key "${t}"?`).then(()=>{a.pub.splice(e,1),a.set(),console.log(`"${t}" public key was deleted`)}).catch(r=>{r!="cancel"&&ElNotification.error({title:"Error",message:`deleteHandler(${t})
`})})}return A(()=>{a.get()}),addEventListener("resize",()=>{g.value=window.outerWidth<900}),(t,e)=>{const r=f("el-text"),p=f("el-button"),m=f("el-drawer"),n=f("el-form-item"),d=f("el-input"),h=f("el-form");return x(),z(F,null,[o(m,{size:g.value?"100%":"50%",modelValue:i.isActive,"onUpdate:modelValue":e[0]||(e[0]=u=>i.isActive=u)},{header:l(()=>[L]),default:l(()=>[b("div",q,[b("div",J,[o(r,null,{default:l(()=>[y(C(i.pub),1)]),_:1})]),b("div",O,[o(r,null,{default:l(()=>[y(C(i.priv),1)]),_:1})])])]),footer:l(()=>[o(p,{type:"success",onClick:H},{default:l(()=>[y(" Copy public ")]),_:1}),o(p,{type:"danger",onClick:T},{default:l(()=>[y(" Copy private ")]),_:1})]),_:1},8,["size","modelValue"]),o(h,null,{default:l(()=>[o(n,null,{default:l(()=>[o(r,null,{default:l(()=>[Q]),_:1})]),_:1}),o(n,null,{default:l(()=>[o(d,{modelValue:s.name,"onUpdate:modelValue":e[1]||(e[1]=u=>s.name=u),placeholder:"keypair name"},null,8,["modelValue"])]),_:1}),o(n,null,{default:l(()=>[o(d,{"show-password":"",modelValue:s.passphrase,"onUpdate:modelValue":e[2]||(e[2]=u=>s.passphrase=u),placeholder:"passphrase"},null,8,["modelValue"])]),_:1}),o(n,null,{default:l(()=>[o(d,{"show-password":"",modelValue:s.rpassphrase,"onUpdate:modelValue":e[3]||(e[3]=u=>s.rpassphrase=u),placeholder:"repeat passphrase"},null,8,["modelValue"])]),_:1}),o(n,null,{default:l(()=>[o(p,{onClick:K,type:"success"},{default:l(()=>[y(" Submit ")]),_:1})]),_:1}),S(a).pub.length!=0?(x(),R(n,{key:0},{default:l(()=>[o(G,{data:S(a).pub,loading:_.value,"is-mobile":g.value,onShow:E,onShare:I,onDelete:N},null,8,["data","loading","is-mobile"])]),_:1})):W("",!0)]),_:1})],64)}}};export{oe as default};
