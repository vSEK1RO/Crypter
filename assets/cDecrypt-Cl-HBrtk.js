import{u as z}from"./keys-3pn1V62-.js";import{e as b,n as C,f as P,g as M,h as D,a as t,w as a,F as E,r as o,o as g,d as v,i as h,t as B,v as F,j as L,E as d,c as N}from"./index-B3lzMfHP.js";import{f as p,c as R}from"./copyData-BSEk4TY7.js";const S=v("h2",null,"Decrypted message",-1),T={class:"drawer-media-wrapper"},H={class:"drawer-media"},W=v("h2",null,"Decrypt message",-1),G={__name:"cDecrypt",setup(j){const w=b(window.outerWidth<900),k=z(),K=C(),n=P({isActive:!1,media:""}),r=P({passphrase:"",privatekey:"",encrypted:K.query.encryptedMsg});b(!1);async function x(m){let e=!1;if(r.passphrase==""&&(d.error({message:"Passphrase must not be empty"}),e=!0,await V(1)),r.privatekey==""&&(d.error({message:"Private key must not be empty"}),e=!0,await V(1)),r.encrypted==""&&(d.error({message:"Encrypted message must not be empty"}),e=!0),e)return;let i=p.pki.decryptRsaPrivateKey(r.privatekey,p.util.encodeUtf8(r.passphrase));if(i==null){d.error("Passphrase incorrect");return}let u=p.pki.privateKeyToPem(i);if(u==null){d.error("Passphrase incorrect");return}let y=p.pki.privateKeyFromPem(u),l=p.util.decode64(r.encrypted);const f=y.n.bitLength()/8;let _="";try{for(;l.length>0;){const c=l.slice(0,f);l=l.slice(f),_+=y.decrypt(c,"RSA-OAEP")}}catch{d.error({message:"Invalid encrypted message"});return}n.media=p.util.decodeUtf8(_),n.isActive=!0}function V(m){return new Promise(e=>setTimeout(e,m))}function A(m){R(n.media,"unnamed","decrypted msg")}return M(()=>{k.get()}),addEventListener("resize",()=>{w.value=window.outerWidth<900}),(m,e)=>{const i=o("el-text"),u=o("el-button"),y=o("el-drawer"),l=o("el-form-item"),f=o("el-option"),_=o("el-select"),c=o("el-input"),U=o("el-form");return g(),D(E,null,[t(y,{size:w.value?"100%":"50%",modelValue:n.isActive,"onUpdate:modelValue":e[0]||(e[0]=s=>n.isActive=s)},{header:a(()=>[S]),default:a(()=>[v("div",T,[v("div",H,[t(i,null,{default:a(()=>[h(B(n.media),1)]),_:1})])])]),footer:a(()=>[t(u,{type:"danger",onClick:A},{default:a(()=>[h(" Copy to clipboard ")]),_:1})]),_:1},8,["size","modelValue"]),t(U,null,{default:a(()=>[t(l,null,{default:a(()=>[t(i,null,{default:a(()=>[W]),_:1})]),_:1}),t(l,null,{default:a(()=>[t(_,{autosize:"","show-password":"",modelValue:r.privatekey,"onUpdate:modelValue":e[1]||(e[1]=s=>r.privatekey=s),placeholder:"private key"},{default:a(()=>[(g(!0),D(E,null,F(L(k).data,s=>(g(),N(f,{key:s.name,label:s.name,value:s.priv},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(l,null,{default:a(()=>[t(c,{"show-password":"",modelValue:r.passphrase,"onUpdate:modelValue":e[2]||(e[2]=s=>r.passphrase=s),placeholder:"passphrase"},null,8,["modelValue"])]),_:1}),t(l,null,{default:a(()=>[t(c,{modelValue:r.encrypted,"onUpdate:modelValue":e[3]||(e[3]=s=>r.encrypted=s),placeholder:"encrypted message"},null,8,["modelValue"])]),_:1}),t(l,null,{default:a(()=>[t(u,{onClick:x,type:"success"},{default:a(()=>[h(" Decrypt ")]),_:1})]),_:1})]),_:1})],64)}}};export{G as default};
