import{u as j}from"./keys-CqsUpnTb.js";import{e as T,u as G,f as I,g as O,h as Y,i as S,a as t,w as o,F as q,r as d,o as y,d as b,j as h,t as K,k as P,l as J,c as E,m as Q,E as u,n as X}from"./index-bx9cgALs.js";import{f as N,t as Z}from"./toBinary-DuiLyPBk.js";const ee=b("h2",null,"Copy and share public key",-1),te={class:"drawer-media-wrapper"},oe={class:"drawer-media"},ae={class:"drawer-media"},ne=b("h2",null,"Generate keypair",-1),le={key:1},re={key:1},de={__name:"cKeys",setup(se){const w=T(window.outerWidth<900),H=G(),n=j(),i=I({name:"",passphrase:"",rpassphrase:""}),k=T(!1),c=I({isActive:!1,name:"",pub:"",priv:""});async function z(a){let e=!1;if(i.passphrase!=i.rpassphrase&&(u.error({title:"Invalid input",message:"Passphrases do not match"}),e=!0,await C(1)),n.pub.findIndex(g=>g.name==i.name)!=-1&&(u.error({title:"Invalid input",message:"Name already exists"}),e=!0,await C(1)),i.name==""&&(u.error({title:"Invalid input",message:"Name must not be empty"}),e=!0,await C(1)),e)return;k.value=!0;let l=N.pki.rsa.generateKeyPair({bits:1024}),p=N.pki.encryptRsaPrivateKey(l.privateKey,Z(i.passphrase)),_=N.pki.publicKeyToPem(l.publicKey);console.log(p),k.value=!1;let r=new Date;const m=r.getUTCHours().toString().padStart(2,"0"),f=r.getUTCMinutes().toString().padStart(2,"0"),x=r.getMonth().toString().padStart(2,"0"),V=r.getDate().toString().padStart(2,"0");n.pub.push({date:`${m}:${f.toString().padStart(2)} - ${V}.${x}`,name:i.name,key:_,priv:p}),n.set(),console.log(_),console.log(`"${i.name}" public key was created`)}function C(a){return new Promise(e=>setTimeout(e,a))}function B(a){let e=n.pub.findIndex(l=>l.name==a);c.isActive=!0,c.pub=n.pub[e].key,c.priv=n.pub[e].priv,c.name=n.pub[e].name,console.log(`"${a}" public key was shown`)}function M(a){navigator.clipboard.writeText(c.pub).then(()=>{u.success("Copied to clipboard")}).catch(e=>{u.error("Error during copying")}),console.log(`"${c.name}" public key was copied`)}function U(a){navigator.clipboard.writeText(c.priv).then(()=>{u.success("Copied to clipboard")}).catch(e=>{u.error("Error during copying")}),console.log(`"${c.name}" public key was copied`)}function $(a,e){let l=n.pub.findIndex(p=>p.name==a);if(e=="click"){let p=window.location.protocol,_=window.location.hostname,r=window.location.port;r==""&&(r="443");let{href:m}=H.resolve({path:"encrypt",query:{publicKey:btoa(n.pub[l].key)}});navigator.clipboard.writeText(`${p}//${_}:${r}${m}`).then(()=>{u.success("Copied to clipboard")}).catch(f=>{u.error("Error during copying")}),console.log(`link to "${c.name}" public key was copied`)}else e=="cancel"?console.log(`redirect to "${a}" public key cancelled`):e=="confirm"&&(H.push({path:"encrypt",query:{publicKey:btoa(n.pub[l].key)}}),console.log(`redirect to "${a}" public key confirmed`))}function A(a){let e=n.pub.findIndex(l=>l.name==a);X.confirm(`Are you sure to delete key "${a}"?`).then(()=>{n.pub.splice(e,1),n.set(),console.log(`"${a}" public key was deleted`)}).catch(l=>{l!="cancel"&&ElNotification.error({title:"Error",message:`deleteHandler(${a})
`})})}return O(()=>{n.get()}),addEventListener("resize",()=>{w.value=window.outerWidth<900}),(a,e)=>{const l=d("el-text"),p=d("el-button"),_=d("el-drawer"),r=d("el-form-item"),m=d("el-input"),f=d("el-table-column"),x=d("el-tag"),V=d("share"),g=d("el-icon"),D=d("el-popconfirm"),F=d("delete"),L=d("el-table"),R=d("el-form"),W=Y("loading");return y(),S(q,null,[t(_,{size:w.value?"100%":"50%",modelValue:c.isActive,"onUpdate:modelValue":e[0]||(e[0]=s=>c.isActive=s)},{header:o(()=>[ee]),default:o(()=>[b("div",te,[b("div",oe,[t(l,null,{default:o(()=>[h(K(c.pub),1)]),_:1})]),b("div",ae,[t(l,null,{default:o(()=>[h(K(c.priv),1)]),_:1})])])]),footer:o(()=>[t(p,{type:"success",onClick:M},{default:o(()=>[h(" Copy public ")]),_:1}),t(p,{type:"danger",onClick:U},{default:o(()=>[h(" Copy private ")]),_:1})]),_:1},8,["size","modelValue"]),t(R,null,{default:o(()=>[t(r,null,{default:o(()=>[t(l,null,{default:o(()=>[ne]),_:1})]),_:1}),t(r,null,{default:o(()=>[t(m,{modelValue:i.name,"onUpdate:modelValue":e[1]||(e[1]=s=>i.name=s),placeholder:"keypair name"},null,8,["modelValue"])]),_:1}),t(r,null,{default:o(()=>[t(m,{"show-password":"",modelValue:i.passphrase,"onUpdate:modelValue":e[2]||(e[2]=s=>i.passphrase=s),placeholder:"passphrase"},null,8,["modelValue"])]),_:1}),t(r,null,{default:o(()=>[t(m,{"show-password":"",modelValue:i.rpassphrase,"onUpdate:modelValue":e[3]||(e[3]=s=>i.rpassphrase=s),placeholder:"repeat passphrase"},null,8,["modelValue"])]),_:1}),t(r,null,{default:o(()=>[t(p,{onClick:z,type:"success"},{default:o(()=>[h(" Submit ")]),_:1})]),_:1}),t(r,null,{default:o(()=>[P(n).pub.length!=0?J((y(),E(L,{key:0,data:P(n).pub},{default:o(()=>[t(f,{label:"Date",prop:"date",width:w.value?"70":"120"},null,8,["width"]),t(f,{label:"Name",prop:"name"},{default:o(s=>[t(x,null,{default:o(()=>[b("h2",null,K(s.row.name),1)]),_:2},1024)]),_:1}),t(f,{align:"right",label:"Operations",fixed:"right","min-width":"120"},{default:o(s=>[t(p,{size:"small",type:"info",onClick:v=>B(s.row.name)},{default:o(()=>[h(" Show ")]),_:2},1032,["onClick"]),t(D,{width:"220","confirm-button-text":"Yes","cancel-button-text":"No",onCancel:v=>$(s.row.name,"cancel"),onConfirm:v=>$(s.row.name,"confirm"),title:"Link copied. Do you want to be redirected?"},{reference:o(()=>[t(p,{size:"small",type:"success",onClick:v=>$(s.row.name,"click")},{default:o(()=>[w.value?(y(),E(g,{key:0},{default:o(()=>[t(V)]),_:1})):(y(),S("div",le,"Share"))]),_:2},1032,["onClick"])]),_:2},1032,["onCancel","onConfirm"]),t(p,{size:"small",type:"danger",onClick:v=>A(s.row.name)},{default:o(()=>[w.value?(y(),E(g,{key:0},{default:o(()=>[t(F)]),_:1})):(y(),S("div",re,"Delete"))]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[W,k.value]]):Q("",!0)]),_:1})]),_:1})],64)}}};export{de as default};
