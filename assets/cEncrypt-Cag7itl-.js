import{m as H,e as v,u as B,n as T,f as k,g as U,h as z,a as n,w as l,F as P,r as p,o as x,d as y,i as b,t as F,j as V,c as O,k as R,E as m,l as j}from"./index-C2e5BLRZ.js";import{f as J,t as K}from"./toBinary-Cl-Oq6Do.js";import{_ as W}from"./cTable-B2Y23O8K.js";const q=H("encrypt",{state:()=>({msg:[]}),actions:{set(){localStorage.setItem("encryptStore",JSON.stringify({msg:this.msg}))},get(){const _=JSON.parse(localStorage.getItem("encryptStore"));_!=null&&(this.msg=_.msg)}}}),L=y("h2",null,"Copy and share encrypted message",-1),D={class:"drawer-media-wrapper"},G={class:"drawer-media"},Q=y("h2",null,"Encrypt message",-1),ee={__name:"cEncrypt",setup(_){const w=v(window.outerWidth<900),$=B(),E=T(),o=q(),a=k({name:"",key:atob(E.query.publicKey||""),message:""}),h=v(!1),c=k({isActive:!1,name:"",media:""});async function C(t){let e=!1;if(o.msg.findIndex(d=>d.name==a.name)!=-1&&(m.error({title:"Invalid input",message:"Name already exists"}),e=!0,await S(1)),a.name==""&&(m.error({title:"Invalid input",message:"Name must not be empty"}),e=!0,await S(1)),a.key==""&&(m.error({title:"Invalid input",message:"Public key must not be empty"}),e=!0,await S(1)),a.message==""&&(m.error({title:"Invalid input",message:"Msg must not be empty"}),e=!0),e)return;h.value=!0;let s=btoa(J.pki.publicKeyFromPem(a.key).encrypt(K(a.message),"RSA-OAEP"));h.value=!1;let i=new Date;const g=i.getUTCHours().toString().padStart(2,"0"),r=i.getUTCMinutes().toString().padStart(2,"0"),u=i.getMonth().toString().padStart(2,"0"),f=i.getDate().toString().padStart(2,"0");o.msg.push({date:`${g}:${r.toString().padStart(2)} - ${f}.${u}`,name:a.name,enc:s}),o.set(),console.log(s),console.log(`"${a.name}" msg was encrypted`)}function S(t){return new Promise(e=>setTimeout(e,t))}function I(t){let e=o.msg.findIndex(s=>s.name==t);c.isActive=!0,c.media=o.msg[e].enc,c.name=o.msg[e].name,console.log(`"${t}" encrypted msg was shown`)}function M(t){navigator.clipboard.writeText(c.media).then(()=>{m.success("Copied to clipboard")}).catch(e=>{m.error("Error during copying")}),console.log(`"${c.name}" encrypted msg was copied`)}function N(t,e){let s=o.msg.findIndex(i=>i.name==t);if(e=="click"){let i=window.location.protocol,g=window.location.hostname,r=window.location.port;r==""&&(r="443");let{href:u}=$.resolve({path:"decrypt",query:{encryptedMsg:o.msg[s].enc}});navigator.clipboard.writeText(`${i}//${g}:${r}/Crypter/${u}`).then(()=>{m.success("Copied to clipboard")}).catch(f=>{m.error("Error during copying")}),console.log(`link to "${c.name}" encrypted msg was copied`)}else e=="cancel"?console.log(`redirect to "${t}" encrypted msg cancelled`):e=="confirm"&&($.push({path:"decrypt",query:{encryptedMsg:o.msg[s].enc}}),console.log(`redirect to "${t}" encrypted msg confirmed`))}function A(t){let e=o.msg.findIndex(s=>s.name==t);j.confirm(`Are you sure to delete msg "${t}"?`).then(()=>{o.msg.splice(e,1),o.set(),console.log(`"${t}" encrypted msg was deleted`)}).catch(s=>{s!="cancel"&&ElNotification.error({title:"Error",message:`deleteHandler(${t})
`})})}return U(()=>{o.get()}),addEventListener("resize",()=>{w.value=window.outerWidth<900}),(t,e)=>{const s=p("el-text"),i=p("el-button"),g=p("el-drawer"),r=p("el-form-item"),u=p("el-input"),f=p("el-form");return x(),z(P,null,[n(g,{size:w.value?"100%":"50%",modelValue:c.isActive,"onUpdate:modelValue":e[0]||(e[0]=d=>c.isActive=d)},{header:l(()=>[L]),default:l(()=>[y("div",D,[y("div",G,[n(s,null,{default:l(()=>[b(F(c.media),1)]),_:1})])])]),footer:l(()=>[n(i,{type:"success",onClick:M},{default:l(()=>[b(" Copy to clipboard ")]),_:1})]),_:1},8,["size","modelValue"]),n(f,null,{default:l(()=>[n(r,null,{default:l(()=>[n(s,null,{default:l(()=>[Q]),_:1})]),_:1}),n(r,null,{default:l(()=>[n(u,{modelValue:a.name,"onUpdate:modelValue":e[1]||(e[1]=d=>a.name=d),placeholder:"message name"},null,8,["modelValue"])]),_:1}),n(r,null,{default:l(()=>[n(u,{autosize:"",type:"textarea",modelValue:a.message,"onUpdate:modelValue":e[2]||(e[2]=d=>a.message=d),placeholder:"message"},null,8,["modelValue"])]),_:1}),n(r,null,{default:l(()=>[n(u,{autosize:"",type:"textarea",modelValue:a.key,"onUpdate:modelValue":e[3]||(e[3]=d=>a.key=d),placeholder:"public key"},null,8,["modelValue"])]),_:1}),n(r,null,{default:l(()=>[n(i,{onClick:C,type:"success"},{default:l(()=>[b(" Encrypt ")]),_:1})]),_:1}),V(o).msg.length!=0?(x(),O(r,{key:0},{default:l(()=>[n(W,{data:V(o).msg,loading:h.value,"is-mobile":w.value,onShow:I,onShare:N,onDelete:A},null,8,["data","loading","is-mobile"])]),_:1})):R("",!0)]),_:1})],64)}}};export{ee as default};
