import{m as H,e as E,u as I,n as U,f as $,g as z,h as R,a as n,w as r,F,r as f,o as v,d as u,i as _,t as V,j as S,c as J,k as K,E as g,l as L}from"./index-B3lzMfHP.js";import{f as w,c as T}from"./copyData-BSEk4TY7.js";import{_ as W,c as q}from"./copyLink-DgrSJAUB.js";const j=H("encrypt",{state:()=>({data:[]}),actions:{set(){localStorage.setItem("encryptStore",JSON.stringify({data:this.data}))},get(){const c=JSON.parse(localStorage.getItem("encryptStore"));(c==null?void 0:c.data[0])!==void 0&&(c.data[0].hasOwnProperty("date")&&c.data[0].hasOwnProperty("name")&&c.data[0].hasOwnProperty("enc")&&c.data[0].hasOwnProperty("raw")&&c.data[0].hasOwnProperty("pub")?this.data=c.data:this.data=[])}}}),D=u("h2",null,"Copy and share encrypted message",-1),G={class:"drawer-media-wrapper"},Q={class:"drawer-media"},X=u("h3",null,"Raw",-1),Y={class:"drawer-media"},Z=u("h3",null,"Encrypted",-1),ee={class:"drawer-media"},te=u("h3",null,"Public key",-1),ae=u("h2",null,"Encrypt message",-1),se={__name:"cEncrypt",setup(c){const h=E(window.outerWidth<900),x=I(),P=U(),a=j(),o=$({name:"",key:w.util.decode64(P.query.publicKey||""),message:""}),N=E(!1),d=$({isActive:!1,name:"",raw:"",enc:"",pub:""});async function C(l){let e=!1;if(a.data.findIndex(s=>s.name==o.name)!=-1&&(g.error({message:"Name already exists"}),e=!0,await b(1)),o.name==""&&(g.error({message:"Name must not be empty"}),e=!0,await b(1)),o.key==""&&(g.error({message:"Public key must not be empty"}),e=!0,await b(1)),o.message==""&&(g.error({message:"Msg must not be empty"}),e=!0),e)return;let t=w.util.encodeUtf8(o.message),i="";try{for(;t.length>0;){const s=t.slice(0,32);t=t.slice(32);const m=w.pki.publicKeyFromPem(o.key).encrypt(s,"RSA-OAEP");i+=m}}catch(s){g.error({message:s});return}let y=new Date;a.data.unshift({date:y,name:o.name.trim(),enc:w.util.encode64(i),raw:o.message,pub:o.key.trim()}),a.set(),console.log(`"${o.name}" msg was encrypted`)}function b(l){return new Promise(e=>setTimeout(e,l))}function M(l){let e=a.data.findIndex(t=>t.name==l);d.isActive=!0,d.name=a.data[e].name,d.enc=a.data[e].enc,d.raw=a.data[e].raw,d.pub=a.data[e].pub,console.log(`"${l}" encrypted msg was shown`)}function O(l){T(d.enc,d.name,"encrypted msg")}function A(l,e){let t=a.data.findIndex(i=>i.name==l);if(e=="click"){let i=window.location.protocol,y=window.location.hostname,s=window.location.port;s==""&&(s="443");let{href:m}=x.resolve({path:"decrypt",query:{encryptedMsg:a.data[t].enc}}),k=`${i}//${y}:${s}/Crypter/${m}`;q(k,d.name,"encrypted msg")}else e=="cancel"?console.log(`redirect to "${l}" encrypted msg cancelled`):e=="confirm"&&(x.push({path:"decrypt",query:{encryptedMsg:a.data[t].enc}}),console.log(`redirect to "${l}" encrypted msg confirmed`))}function B(l){let e=a.data.findIndex(t=>t.name==l);L.confirm(`Are you sure to delete msg "${l}"?`).then(()=>{a.data.splice(e,1),a.set(),console.log(`"${l}" encrypted msg was deleted`)}).catch(t=>{t!="cancel"&&ElNotification.error({title:"Error",message:`deleteHandler(${l})
`})})}return z(()=>{a.get()}),addEventListener("resize",()=>{h.value=window.outerWidth<900}),(l,e)=>{const t=f("el-text"),i=f("el-button"),y=f("el-drawer"),s=f("el-form-item"),m=f("el-input"),k=f("el-form");return v(),R(F,null,[n(y,{size:h.value?"100%":"50%",modelValue:d.isActive,"onUpdate:modelValue":e[0]||(e[0]=p=>d.isActive=p)},{header:r(()=>[D]),default:r(()=>[u("div",G,[u("div",Q,[n(t,null,{default:r(()=>[X,_(" "+V(d.raw),1)]),_:1})]),u("div",Y,[n(t,null,{default:r(()=>[Z,_(" "+V(d.enc),1)]),_:1})]),u("div",ee,[n(t,null,{default:r(()=>[te,_(" "+V(d.pub),1)]),_:1})])])]),footer:r(()=>[n(i,{type:"success",onClick:O},{default:r(()=>[_(" Copy to clipboard ")]),_:1})]),_:1},8,["size","modelValue"]),n(k,null,{default:r(()=>[n(s,null,{default:r(()=>[n(t,null,{default:r(()=>[ae]),_:1})]),_:1}),n(s,null,{default:r(()=>[n(m,{modelValue:o.name,"onUpdate:modelValue":e[1]||(e[1]=p=>o.name=p),placeholder:"message name"},null,8,["modelValue"])]),_:1}),n(s,null,{default:r(()=>[n(m,{autosize:"",type:"textarea",modelValue:o.message,"onUpdate:modelValue":e[2]||(e[2]=p=>o.message=p),placeholder:"message"},null,8,["modelValue"])]),_:1}),n(s,null,{default:r(()=>[n(m,{modelValue:o.key,"onUpdate:modelValue":e[3]||(e[3]=p=>o.key=p),placeholder:"public key"},null,8,["modelValue"])]),_:1}),n(s,null,{default:r(()=>[n(i,{onClick:C,type:"success"},{default:r(()=>[_(" Encrypt ")]),_:1})]),_:1}),S(a).data.length!=0?(v(),J(s,{key:0},{default:r(()=>[n(W,{data:S(a).data,loading:N.value,"is-mobile":h.value,onShow:M,onShare:A,onDelete:B},null,8,["data","loading","is-mobile"])]),_:1})):K("",!0)]),_:1})],64)}}};export{se as default};
