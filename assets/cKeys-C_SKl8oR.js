import{u as A}from"./keys-DeLP3Xqx.js";import{r as d,o as m,c as x,w as o,a as t,d as w,e as K,f as T,u as D,g as I,h as F,F as L,i as C,t as P,j as z,k as R,E as p,l as W}from"./index-BLUod_VL.js";import{f as N,t as j}from"./toBinary-ybFcCrfb.js";const G={class:"operations-wrapper"},O={key:1},Y={key:1},q={key:1},J={__name:"cTable",props:["data","loading","isMobile"],emits:["show","share","delete"],setup(f,{emit:g}){const b=g;function i(a){b("show",a)}function s(a,V){b("share",a,V)}function k(a){b("delete",a)}return(a,V)=>{const _=d("el-table-column"),M=d("View"),v=d("el-icon"),$=d("el-button"),H=d("share"),E=d("el-popconfirm"),l=d("delete"),e=d("el-table");return m(),x(e,{data:f.data,"v-loading":f.loading},{default:o(()=>[t(_,{label:"Date",prop:"date",width:f.isMobile?"70":"120"},null,8,["width"]),t(_,{label:"Name",prop:"name"}),t(_,{align:"right",label:"Operations",fixed:"right",width:f.isMobile?"102px":"220px"},{default:o(n=>[w("div",G,[t($,{size:"small",type:"info",onClick:r=>i(n.row.name)},{default:o(()=>[f.isMobile?(m(),x(v,{key:0},{default:o(()=>[t(M)]),_:1})):(m(),K("div",O,"Show"))]),_:2},1032,["onClick"]),t(E,{width:"220","confirm-button-text":"Yes","cancel-button-text":"No",onCancel:r=>s(n.row.name,"cancel"),onConfirm:r=>s(n.row.name,"confirm"),title:"Link copied. Do you want to be redirected?"},{reference:o(()=>[t($,{size:"small",type:"success",onClick:r=>s(n.row.name,"click")},{default:o(()=>[f.isMobile?(m(),x(v,{key:0},{default:o(()=>[t(H)]),_:1})):(m(),K("div",Y,"Share"))]),_:2},1032,["onClick"])]),_:2},1032,["onCancel","onConfirm"]),t($,{size:"small",type:"danger",onClick:r=>k(n.row.name)},{default:o(()=>[f.isMobile?(m(),x(v,{key:0},{default:o(()=>[t(l)]),_:1})):(m(),K("div",q,"Delete"))]),_:2},1032,["onClick"])])]),_:1},8,["width"])]),_:1},8,["data","v-loading"])}}},Q=w("h2",null,"Copy and share public key",-1),X={class:"drawer-media-wrapper"},Z={class:"drawer-media"},ee={class:"drawer-media"},te=w("h2",null,"Generate keypair",-1),le={__name:"cKeys",setup(f){const g=T(window.outerWidth<900),b=D(),i=A(),s=I({name:"",passphrase:"",rpassphrase:""}),k=T(!1),a=I({isActive:!1,name:"",pub:"",priv:""});async function V(l){let e=!1;if(s.passphrase!=s.rpassphrase&&(p.error({title:"Invalid input",message:"Passphrases do not match"}),e=!0,await _(1)),i.pub.findIndex(U=>U.name==s.name)!=-1&&(p.error({title:"Invalid input",message:"Name already exists"}),e=!0,await _(1)),s.name==""&&(p.error({title:"Invalid input",message:"Name must not be empty"}),e=!0,await _(1)),e)return;k.value=!0;let n=N.pki.rsa.generateKeyPair({bits:1024}),r=N.pki.encryptRsaPrivateKey(n.privateKey,j(s.passphrase)),y=N.pki.publicKeyToPem(n.publicKey);console.log(r),k.value=!1;let c=new Date;const h=c.getUTCHours().toString().padStart(2,"0"),S=c.getUTCMinutes().toString().padStart(2,"0"),u=c.getMonth().toString().padStart(2,"0"),B=c.getDate().toString().padStart(2,"0");i.pub.push({date:`${h}:${S.toString().padStart(2)} - ${B}.${u}`,name:s.name,key:y,priv:r}),i.set(),console.log(y),console.log(`"${s.name}" public key was created`)}function _(l){return new Promise(e=>setTimeout(e,l))}function M(l){let e=i.pub.findIndex(n=>n.name==l);a.isActive=!0,a.pub=i.pub[e].key,a.priv=i.pub[e].priv,a.name=i.pub[e].name,console.log(`"${l}" public key was shown`)}function v(l){navigator.clipboard.writeText(a.pub).then(()=>{p.success("Copied to clipboard")}).catch(e=>{p.error("Error during copying")}),console.log(`"${a.name}" public key was copied`)}function $(l){navigator.clipboard.writeText(a.priv).then(()=>{p.success("Copied to clipboard")}).catch(e=>{p.error("Error during copying")}),console.log(`"${a.name}" public key was copied`)}function H(l,e){let n=i.pub.findIndex(r=>r.name==l);if(e=="click"){let r=window.location.protocol,y=window.location.hostname,c=window.location.port;c==""&&(c="443");let{href:h}=b.resolve({path:"encrypt",query:{publicKey:btoa(i.pub[n].key)}});navigator.clipboard.writeText(`${r}//${y}:${c}${h}`).then(()=>{p.success("Copied to clipboard")}).catch(S=>{p.error("Error during copying")}),console.log(`link to "${a.name}" public key was copied`)}else e=="cancel"?console.log(`redirect to "${l}" public key cancelled`):e=="confirm"&&(b.push({path:"encrypt",query:{publicKey:btoa(i.pub[n].key)}}),console.log(`redirect to "${l}" public key confirmed`))}function E(l){let e=i.pub.findIndex(n=>n.name==l);W.confirm(`Are you sure to delete key "${l}"?`).then(()=>{i.pub.splice(e,1),i.set(),console.log(`"${l}" public key was deleted`)}).catch(n=>{n!="cancel"&&ElNotification.error({title:"Error",message:`deleteHandler(${l})
`})})}return F(()=>{i.get()}),addEventListener("resize",()=>{g.value=window.outerWidth<900}),(l,e)=>{const n=d("el-text"),r=d("el-button"),y=d("el-drawer"),c=d("el-form-item"),h=d("el-input"),S=d("el-form");return m(),K(L,null,[t(y,{size:g.value?"100%":"50%",modelValue:a.isActive,"onUpdate:modelValue":e[0]||(e[0]=u=>a.isActive=u)},{header:o(()=>[Q]),default:o(()=>[w("div",X,[w("div",Z,[t(n,null,{default:o(()=>[C(P(a.pub),1)]),_:1})]),w("div",ee,[t(n,null,{default:o(()=>[C(P(a.priv),1)]),_:1})])])]),footer:o(()=>[t(r,{type:"success",onClick:v},{default:o(()=>[C(" Copy public ")]),_:1}),t(r,{type:"danger",onClick:$},{default:o(()=>[C(" Copy private ")]),_:1})]),_:1},8,["size","modelValue"]),t(S,null,{default:o(()=>[t(c,null,{default:o(()=>[t(n,null,{default:o(()=>[te]),_:1})]),_:1}),t(c,null,{default:o(()=>[t(h,{modelValue:s.name,"onUpdate:modelValue":e[1]||(e[1]=u=>s.name=u),placeholder:"keypair name"},null,8,["modelValue"])]),_:1}),t(c,null,{default:o(()=>[t(h,{"show-password":"",modelValue:s.passphrase,"onUpdate:modelValue":e[2]||(e[2]=u=>s.passphrase=u),placeholder:"passphrase"},null,8,["modelValue"])]),_:1}),t(c,null,{default:o(()=>[t(h,{"show-password":"",modelValue:s.rpassphrase,"onUpdate:modelValue":e[3]||(e[3]=u=>s.rpassphrase=u),placeholder:"repeat passphrase"},null,8,["modelValue"])]),_:1}),t(c,null,{default:o(()=>[t(r,{onClick:V,type:"success"},{default:o(()=>[C(" Submit ")]),_:1})]),_:1}),t(c,null,{default:o(()=>[z(i).pub.length!=0?(m(),x(J,{key:0,data:z(i).pub,loading:k.value,"is-mobile":g.value,onShow:M,onShare:H,onDelete:E},null,8,["data","loading","is-mobile"])):R("",!0)]),_:1})]),_:1})],64)}}};export{le as default};
