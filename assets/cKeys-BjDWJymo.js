import{u as I}from"./keys-t4jBpoko.js";import{e as $,u as U,f as V,g as j,h as M,a as l,w as s,F as R,r as b,o as N,d as _,i as h,t as E,j as x,c as z,k as J,E as f,l as L}from"./index-9m_TVREg.js";import{f as C,t as W}from"./toBinary-GVOEpgjp.js";import{_ as G}from"./cTable-DiynaARr.js";function q(g,d){const y=new Blob([d],{type:"text/csv"});if(window.navigator.msSaveOrOpenBlob)window.navigator.msSaveBlob(y,g);else{const a=window.document.createElement("a");a.href=window.URL.createObjectURL(y),a.download=g,document.body.appendChild(a),a.click(),document.body.removeChild(a)}}function Q(g){const d=window.document.createElement("input");d.type="file",document.body.appendChild(d),d.onchange=()=>{let y=d.files[0];document.body.removeChild(d),g(y)},d.oncancel=()=>{document.body.removeChild(d)},d.click()}const X=_("h2",null,"Copy and share public key",-1),Y={class:"drawer-media-wrapper"},Z={class:"drawer-media"},D={class:"drawer-media"},ee=_("h2",null,"Generate keypair",-1),ne={__name:"cKeys",setup(g){const d=$(window.outerWidth<900),y=U(),a=I(),u=V({name:"",passphrase:"",rpassphrase:""}),v=$(!1),m=V({isActive:!1,name:"",pub:"",priv:""});async function K(o){let e=!1;if(u.passphrase!=u.rpassphrase&&(f.error({message:"Passphrases do not match"}),e=!0,await k(1)),a.data.findIndex(r=>r.name==u.name)!=-1&&(f.error({message:"Name already exists"}),e=!0,await k(1)),u.name==""&&(f.error({message:"Name must not be empty"}),e=!0,await k(1)),e)return;v.value=!0;let n=C.pki.rsa.generateKeyPair({bits:1024}),p=C.pki.encryptRsaPrivateKey(n.privateKey,W(u.passphrase)),t=C.pki.publicKeyToPem(n.publicKey);v.value=!1;let i=new Date;a.data.unshift({date:i,name:u.name,pub:t,priv:p}),a.set(),console.log(`"${u.name}" keypair was created`)}function k(o){return new Promise(e=>setTimeout(e,o))}function O(o){let e=a.data.findIndex(n=>n.name==o);m.isActive=!0,m.pub=a.data[e].pub,m.priv=a.data[e].priv,m.name=a.data[e].name,console.log(`"${o}" public key was shown`)}function P(o){navigator.clipboard.writeText(m.pub).then(()=>{f.success("Copied to clipboard")}).catch(e=>{f.error("Error during copying")}),console.log(`"${m.name}" public key was copied`)}function B(o){navigator.clipboard.writeText(m.priv).then(()=>{f.success("Copied to clipboard")}).catch(e=>{f.error("Error during copying")}),console.log(`"${m.name}" public key was copied`)}function S(o,e){let n=a.data.findIndex(p=>p.name==o);if(e=="click"){let p=window.location.protocol,t=window.location.hostname,i=window.location.port;i==""&&(i="443");let{href:r}=y.resolve({path:"encrypt",query:{publicKey:btoa(a.data[n].pub)}});navigator.clipboard.writeText(`${p}//${t}:${i}/Crypter/${r}`).then(()=>{f.success("Copied to clipboard")}).catch(w=>{f.error("Error during copying")}),console.log(`link to "${m.name}" public key was copied`)}else e=="cancel"?console.log(`redirect to "${o}" public key cancelled`):e=="confirm"&&(y.push({path:"encrypt",query:{publicKey:btoa(a.data[n].pub)}}),console.log(`redirect to "${o}" public key confirmed`))}function H(o){let e=a.data.findIndex(n=>n.name==o);L.confirm(`Are you sure to delete key "${o}"?`).then(()=>{a.data.splice(e,1),a.set(),console.log(`"${o}" public key was deleted`)}).catch(n=>{n!="cancel"&&ElNotification.error({title:"Error",message:`deleteHandler(${o})
`})})}function A(){q("keys.json",JSON.stringify(a.data)),console.log('keys were exported to "keys.json"')}function F(o){if(o.size>4*2**20){f.error({message:"File is larger than 4MB"});return}const e=new FileReader;e.onload=()=>{let n={};try{n=JSON.parse(e.result)}catch{f.error({message:"File isn't JSON"});return}if(!Array.isArray(n)){f.error({message:"Incorrect JSON format: isn't array"});return}let p=!1;n.forEach(t=>{var i;if(t.hasOwnProperty("date")&&t.hasOwnProperty("name")&&t.hasOwnProperty("pub")&&t.hasOwnProperty("priv")&&a.data.find(r=>r.date===t.date&&r.pub===t.pub&&r.priv===t.priv)===void 0){p=!0;let r={};if(a.data.find(c=>c.name==t.name)===void 0)r.name=t.name;else{let c=2;for(;r.name===void 0;)a.data.find(T=>T.name===t.name+`_${c}`)===void 0&&(r.name=t.name+`_${c}`),c++}r.date=t.date,r.pub=t.pub,r.priv=t.priv;let w=0;for(;a.data[w]!=null&&((i=a.data[w])==null?void 0:i.date)>r.date;)w++;a.data.splice(w,0,r)}}),p?(a.set(),console.log(`some keys were imported from "${o.name}"`)):f({message:"Nothing has been added"})},e.readAsText(o)}return j(()=>{a.get()}),addEventListener("resize",()=>{d.value=window.outerWidth<900}),(o,e)=>{const n=b("el-text"),p=b("el-button"),t=b("el-drawer"),i=b("el-form-item"),r=b("el-input"),w=b("el-form");return N(),M(R,null,[l(t,{size:d.value?"100%":"50%",modelValue:m.isActive,"onUpdate:modelValue":e[0]||(e[0]=c=>m.isActive=c)},{header:s(()=>[X]),default:s(()=>[_("div",Y,[_("div",Z,[l(n,null,{default:s(()=>[h(E(m.pub),1)]),_:1})]),_("div",D,[l(n,null,{default:s(()=>[h(E(m.priv),1)]),_:1})])])]),footer:s(()=>[l(p,{type:"success",onClick:P},{default:s(()=>[h(" Copy public ")]),_:1}),l(p,{type:"danger",onClick:B},{default:s(()=>[h(" Copy private ")]),_:1})]),_:1},8,["size","modelValue"]),l(w,null,{default:s(()=>[l(i,null,{default:s(()=>[l(n,null,{default:s(()=>[ee]),_:1})]),_:1}),l(i,null,{default:s(()=>[l(r,{modelValue:u.name,"onUpdate:modelValue":e[1]||(e[1]=c=>u.name=c),placeholder:"keypair name"},null,8,["modelValue"])]),_:1}),l(i,null,{default:s(()=>[l(r,{"show-password":"",modelValue:u.passphrase,"onUpdate:modelValue":e[2]||(e[2]=c=>u.passphrase=c),placeholder:"passphrase"},null,8,["modelValue"])]),_:1}),l(i,null,{default:s(()=>[l(r,{"show-password":"",modelValue:u.rpassphrase,"onUpdate:modelValue":e[3]||(e[3]=c=>u.rpassphrase=c),placeholder:"repeat passphrase"},null,8,["modelValue"])]),_:1}),l(i,null,{default:s(()=>[l(p,{onClick:K,type:"success"},{default:s(()=>[h(" Submit ")]),_:1}),l(p,{onClick:A},{default:s(()=>[h(" Export ")]),_:1}),l(p,{onClick:e[4]||(e[4]=c=>x(Q)(F))},{default:s(()=>[h(" Import ")]),_:1})]),_:1}),x(a).data.length!=0?(N(),z(i,{key:0},{default:s(()=>[l(G,{data:x(a).data,loading:v.value,"is-mobile":d.value,onShow:O,onShare:S,onDelete:H},null,8,["data","loading","is-mobile"])]),_:1})):J("",!0)]),_:1})],64)}}};export{ne as default};
