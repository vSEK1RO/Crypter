import{u as M}from"./keys-t4jBpoko.js";import{e as A,n as T,f as C,g as F,h as x,a as t,w as r,F as D,r as s,o as g,d as _,i as h,t as N,q as R,j as S,E as n,c as q}from"./index-9m_TVREg.js";import{f as w,t as H}from"./toBinary-GVOEpgjp.js";function E(k){const c=atob(k),i=new Uint8Array(c.length);for(let p=0;p<i.length;p++)i[p]=c.charCodeAt(p);return String.fromCharCode(...new Uint16Array(i.buffer))}const L=_("h2",null,"Decrypted message",-1),W={class:"drawer-media-wrapper"},j={class:"drawer-media"},I=_("h2",null,"Decrypt message",-1),J={__name:"cDecrypt",setup(k){const c=A(window.outerWidth<900),i=M(),p=T(),l=C({isActive:!1,media:""}),a=C({passphrase:"",privatekey:"",encrypted:p.query.encryptedMsg}),b=A(!1);async function K(y){let e=!1;if(a.passphrase==""&&(n.error({message:"Passphrase must not be empty"}),e=!0,await V(1)),a.privatekey==""&&(n.error({message:"Private key must not be empty"}),e=!0,await V(1)),a.encrypted==""&&(n.error({message:"Encrypted message must not be empty"}),e=!0),e)return;b.value=!0;let m="";try{let u=w.pki.decryptRsaPrivateKey(a.privatekey,H(a.passphrase));if(u==null){n.error("Passphrase incorrect");return}let f=w.pki.privateKeyToPem(u);if(f==null){n.error("Passphrase incorrect");return}let d=E(a.encrypted),v=w.pki.privateKeyFromPem(f);m=E(v.decrypt(d,"RSA-OAEP")||"")}catch{n.error({message:"Invalid encrypted message"});return}b.value=!1,l.media=m,l.isActive=!0}function V(y){return new Promise(e=>setTimeout(e,y))}function B(y){navigator.clipboard.writeText(l.media).then(()=>{n.success("Copied to clipboard")}).catch(e=>{n.error("Error during copying")}),console.log(`"${l.name}" decrypted msg was copied`)}return F(()=>{i.get()}),addEventListener("resize",()=>{c.value=window.outerWidth<900}),(y,e)=>{const m=s("el-text"),u=s("el-button"),f=s("el-drawer"),d=s("el-form-item"),v=s("el-option"),U=s("el-select"),P=s("el-input"),z=s("el-form");return g(),x(D,null,[t(f,{size:c.value?"100%":"50%",modelValue:l.isActive,"onUpdate:modelValue":e[0]||(e[0]=o=>l.isActive=o)},{header:r(()=>[L]),default:r(()=>[_("div",W,[_("div",j,[t(m,null,{default:r(()=>[h(N(l.media),1)]),_:1})])])]),footer:r(()=>[t(u,{type:"danger",onClick:B},{default:r(()=>[h(" Copy to clipboard ")]),_:1})]),_:1},8,["size","modelValue"]),t(z,null,{default:r(()=>[t(d,null,{default:r(()=>[t(m,null,{default:r(()=>[I]),_:1})]),_:1}),t(d,null,{default:r(()=>[t(U,{autosize:"","show-password":"",modelValue:a.privatekey,"onUpdate:modelValue":e[1]||(e[1]=o=>a.privatekey=o),placeholder:"private key"},{default:r(()=>[(g(!0),x(D,null,R(S(i).data,o=>(g(),q(v,{key:o.name,label:o.name,value:o.priv},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(d,null,{default:r(()=>[t(P,{"show-password":"",modelValue:a.passphrase,"onUpdate:modelValue":e[2]||(e[2]=o=>a.passphrase=o),placeholder:"passphrase"},null,8,["modelValue"])]),_:1}),t(d,null,{default:r(()=>[t(P,{autosize:"",type:"textarea",modelValue:a.encrypted,"onUpdate:modelValue":e[3]||(e[3]=o=>a.encrypted=o),placeholder:"encrypted message"},null,8,["modelValue"])]),_:1}),t(d,null,{default:r(()=>[t(u,{onClick:K,type:"success"},{default:r(()=>[h(" Decrypt ")]),_:1})]),_:1})]),_:1})],64)}}};export{J as default};
