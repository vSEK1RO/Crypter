import{u as z}from"./keys-CqsUpnTb.js";import{e as V,s as M,f as P,g as T,i as A,a as t,w as a,F as C,r as l,o as g,d as v,j as h,t as F,v as N,k as R,E as p,c as S}from"./index-bx9cgALs.js";import{f as w,t as H}from"./toBinary-DuiLyPBk.js";function I(b){const u=atob(b),i=new Uint8Array(u.length);for(let d=0;d<i.length;d++)i[d]=u.charCodeAt(d);return String.fromCharCode(...new Uint16Array(i.buffer))}const L=v("h2",null,"Decrypted message",-1),W={class:"drawer-media-wrapper"},j={class:"drawer-media"},q=v("h2",null,"Decrypt message",-1),J={__name:"cDecrypt",setup(b){const u=V(window.outerWidth<900),i=z(),d=M(),s=P({isActive:!1,media:""}),r=P({passphrase:"",privatekey:"",encrypted:d.query.encryptedMsg}),k=V(!1);async function x(y){let e=!1;if(r.passphrase==""&&(p.error({title:"Invalid input",message:"Passphrase must not be empty"}),e=!0,await D(1)),r.encrypted==""&&(p.error({title:"Invalid input",message:"Encrypted message must not be empty"}),e=!0),e)return;k.value=!0;let c=w.pki.decryptRsaPrivateKey(r.privatekey,H(r.passphrase));c==null&&p.error("Passphrase incorrect");let m=w.pki.privateKeyToPem(c);m==null&&p.error("Passphrase incorrect");let f="";r.encrypted!=null&&(f=atob(r.encrypted));let n=w.pki.privateKeyFromPem(m),_=I(n.decrypt(f,"RSA-OAEP"));k.value=!1,s.media=_,s.isActive=!0}function D(y){return new Promise(e=>setTimeout(e,y))}function E(y){navigator.clipboard.writeText(s.media).then(()=>{p.success("Copied to clipboard")}).catch(e=>{p.error("Error during copying")}),console.log(`"${s.name}" decrypted msg was copied`)}return T(()=>{i.get()}),addEventListener("resize",()=>{u.value=window.outerWidth<900}),(y,e)=>{const c=l("el-text"),m=l("el-button"),f=l("el-drawer"),n=l("el-form-item"),_=l("el-input"),K=l("el-option"),B=l("el-select"),U=l("el-form");return g(),A(C,null,[t(f,{size:u.value?"100%":"50%",modelValue:s.isActive,"onUpdate:modelValue":e[0]||(e[0]=o=>s.isActive=o)},{header:a(()=>[L]),default:a(()=>[v("div",W,[v("div",j,[t(c,null,{default:a(()=>[h(F(s.media),1)]),_:1})])])]),footer:a(()=>[t(m,{type:"danger",onClick:E},{default:a(()=>[h(" Copy to clipboard ")]),_:1})]),_:1},8,["size","modelValue"]),t(U,null,{default:a(()=>[t(n,null,{default:a(()=>[t(c,null,{default:a(()=>[q]),_:1})]),_:1}),t(n,null,{default:a(()=>[t(_,{"show-password":"",modelValue:r.passphrase,"onUpdate:modelValue":e[1]||(e[1]=o=>r.passphrase=o),placeholder:"passphrase"},null,8,["modelValue"])]),_:1}),t(n,null,{default:a(()=>[t(B,{autosize:"","show-password":"",modelValue:r.privatekey,"onUpdate:modelValue":e[2]||(e[2]=o=>r.privatekey=o),placeholder:"private key"},{default:a(()=>[(g(!0),A(C,null,N(R(i).pub,o=>(g(),S(K,{key:o.name,label:o.name,value:o.priv},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(n,null,{default:a(()=>[t(_,{autosize:"",type:"textarea",modelValue:r.encrypted,"onUpdate:modelValue":e[3]||(e[3]=o=>r.encrypted=o),placeholder:"encrypted message"},null,8,["modelValue"])]),_:1}),t(n,null,{default:a(()=>[t(m,{onClick:x,type:"success"},{default:a(()=>[h(" Decrypt ")]),_:1})]),_:1})]),_:1})],64)}}};export{J as default};
